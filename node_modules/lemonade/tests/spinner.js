/**
 * Change into the test app dir
 */
process.chdir(__dirname + '/spinner-test-app');

var  assert  = require('assert')
    ,http    = require('http')
    ,Kernel  = require('../kernel/kernel.js')
    ,krnl    = new Kernel({}, {}, {
        spinner : 'spinner'
    }, {});

krnl.once(krnl.ONLINE, function() {

    assert.ok(Object.keys(krnl.status().spinner.pending).length === 3);
    console.log(krnl.utility.ansi('green', '[ OK ]') + ' loading');

    var lastrun;
    setTimeout(function() {
        lastrun = krnl.status().spinner.lastrun;
    }, 2000);
    setTimeout(function() {

        assert.ok(krnl.status().spinner.lastrun > lastrun);
        console.log(krnl.utility.ansi('green', '[ OK ]') + ' spinning');

        assert.ok(krnl.status().spinner.count > 0);
        console.log(krnl.utility.ansi('green', '[ OK ]') + ' spawning');

        krnl.shutdown('bye bye');

    }, 3100);
});